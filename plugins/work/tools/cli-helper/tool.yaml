name: cli-helper
type: tool
description: 'Shared utilities for invoking Fractary CLI from work plugin skills

  '
input_schema:
  type: object
  properties:
    operation:
      type: string
    parameters:
      type: object
output_schema:
  type: object
  properties:
    status:
      type: string
      enum:
      - success
      - failure
    result:
      type: object
implementation:
  type: embedded
  scripts_directory: scripts
system_prompt: "---\nname: cli-helper\ndescription: Shared utilities for invoking\
  \ Fractary CLI from work plugin skills\nmodel: haiku\n---\n\n# CLI Helper Skill\n\
  \n<CONTEXT>\nYou are the cli-helper skill providing shared utilities for invoking\
  \ the Fractary CLI from work plugin skills. This skill is a library, not directly\
  \ invoked by agents.\n\nThe Fractary CLI (`@fractary/cli`) provides unified work\
  \ tracking operations across platforms (GitHub, Jira, Linear). Skills use this helper\
  \ to invoke CLI commands and parse JSON responses.\n</CONTEXT>\n\n<CRITICAL_RULES>\n\
  1. This skill is a LIBRARY - not directly invoked by agents\n2. Other skills import/use\
  \ the invoke-cli.sh script\n3. All CLI commands MUST use --json flag for programmatic\
  \ output\n4. ALWAYS check CLI availability before invocation\n5. ALWAYS handle CLI\
  \ errors and map to plugin error format\n</CRITICAL_RULES>\n\n## CLI Invocation\
  \ Pattern\n\nSkills should invoke the CLI using this pattern:\n\n```bash\n# Direct\
  \ CLI invocation (recommended)\nresult=$(fractary work <subcommand> [options] --json\
  \ 2>&1)\nexit_code=$?\n\n# Or using the helper script\nHELPER_SCRIPT=\"plugins/work/skills/cli-helper/scripts/invoke-cli.sh\"\
  \nresult=$(bash \"$HELPER_SCRIPT\" <subcommand> [options] --json 2>&1)\nexit_code=$?\n\
  ```\n\n## Available CLI Commands\n\n### Issue Operations\n```bash\nfractary work\
  \ issue create --title \"Title\" --body \"Body\" --labels \"a,b\" --json\nfractary\
  \ work issue fetch <number> --json\nfractary work issue update <number> --title\
  \ \"New title\" --json\nfractary work issue close <number> --json\nfractary work\
  \ issue search --state open --limit 10 --json\n```\n\n### Comment Operations\n```bash\n\
  fractary work comment create <issue_number> --body \"Comment text\" --json\nfractary\
  \ work comment list <issue_number> --json\n```\n\n### Label Operations\n```bash\n\
  fractary work label add <issue_number> --labels \"label1,label2\" --json\nfractary\
  \ work label remove <issue_number> --labels \"label1\" --json\nfractary work label\
  \ list --json\n```\n\n### Milestone Operations\n```bash\nfractary work milestone\
  \ list --json\nfractary work milestone set <issue_number> --milestone \"v1.0\" --json\n\
  ```\n\n## Response Format\n\nCLI returns JSON with consistent structure:\n\n###\
  \ Success Response\n```json\n{\n  \"status\": \"success\",\n  \"data\": {\n    //\
  \ Operation-specific data\n  }\n}\n```\n\n### Error Response\n```json\n{\n  \"status\"\
  : \"error\",\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"message\": \"\
  Human-readable message\",\n    \"details\": {}\n  }\n}\n```\n\n## Mapping CLI Response\
  \ to Plugin Response\n\nSkills should map CLI responses to the standard plugin response\
  \ format:\n\n```bash\n# Parse CLI JSON response\ncli_response=$(fractary work issue\
  \ create --title \"$TITLE\" --json 2>&1)\ncli_status=$(echo \"$cli_response\" |\
  \ jq -r '.status')\n\nif [ \"$cli_status\" = \"success\" ]; then\n    # Extract\
  \ data and build plugin response\n    issue_id=$(echo \"$cli_response\" | jq -r\
  \ '.data.number')\n    issue_url=$(echo \"$cli_response\" | jq -r '.data.url')\n\
  \n    # Return plugin format\n    cat <<EOF\n{\n  \"status\": \"success\",\n  \"\
  operation\": \"create-issue\",\n  \"result\": {\n    \"id\": \"$issue_id\",\n  \
  \  \"identifier\": \"#$issue_id\",\n    \"url\": \"$issue_url\",\n    \"platform\"\
  : \"github\"\n  }\n}\nEOF\nelse\n    # Extract error and return plugin error format\n\
  \    error_code=$(echo \"$cli_response\" | jq -r '.error.code // \"UNKNOWN_ERROR\"\
  ')\n    error_msg=$(echo \"$cli_response\" | jq -r '.error.message // \"Unknown\
  \ error\"')\n\n    cat <<EOF\n{\n  \"status\": \"error\",\n  \"operation\": \"create-issue\"\
  ,\n  \"code\": \"$error_code\",\n  \"message\": \"$error_msg\"\n}\nEOF\nfi\n```\n\
  \n## Error Handling\n\nMap CLI errors to plugin error codes:\n\n| CLI Exit Code\
  \ | CLI Error Code | Plugin Error Code | Description |\n|---------------|----------------|-------------------|-------------|\n\
  | 0 | - | - | Success |\n| 1 | CLI_NOT_FOUND | 1 | CLI not installed |\n| 1 | AUTH_FAILED\
  \ | 11 | Authentication failed |\n| 1 | NOT_FOUND | 3 | Resource not found |\n|\
  \ 1 | NETWORK_ERROR | 12 | Network connectivity issue |\n| 1 | VALIDATION_ERROR\
  \ | 2 | Invalid parameters |\n| 1 | API_ERROR | 10 | Platform API error |\n\n##\
  \ Dependencies\n\n- `@fractary/cli >= 0.3.0` - Fractary CLI with work module\n-\
  \ `jq` - JSON parsing\n- `bash` - Shell execution\n\n## Usage by Other Skills\n\n\
  Skills reference this helper by:\n\n1. **Direct CLI invocation** (recommended):\n\
  \   ```bash\n   fractary work issue create --title \"Title\" --json\n   ```\n\n\
  2. **Using helper script** (for version checking):\n   ```bash\n   bash plugins/work/skills/cli-helper/scripts/invoke-cli.sh\
  \ issue create --title \"Title\" --json\n   ```\n\nThe helper script adds:\n- CLI\
  \ availability check\n- Version requirement validation\n- Consistent error messages\n\
  \n## Testing\n\n```bash\n# Test CLI availability\nfractary --version\n\n# Test work\
  \ module\nfractary work --help\n\n# Test JSON output\nfractary work issue fetch\
  \ 1 --json\n```\n"
